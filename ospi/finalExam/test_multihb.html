    <pre>
<span class="comment">(* Construct a parameterized Diode model *)</span>
<span class="tuareg-font-lock-governing">module</span> <span class="type">Diode </span><span class="tuareg-font-lock-operator">=</span> <span class="type">Circuit_models</span>.Diode<span class="tuareg-font-lock-operator">(</span><span class="tuareg-font-lock-governing">struct</span> <span class="tuareg-font-lock-governing">let</span> <span class="variable-name">vt</span><span class="tuareg-font-lock-operator">=</span>vt <span class="tuareg-font-lock-governing">and</span> <span class="variable-name">io</span><span class="tuareg-font-lock-operator">=</span>io <span class="tuareg-font-lock-governing">end</span><span class="tuareg-font-lock-operator">);;</span>

<span class="tuareg-font-lock-governing">let</span> <span class="function-name">test_circuit_multihb</span><span class="variable-name"> </span><span class="tuareg-font-lock-operator">()</span><span class="variable-name"> </span><span class="tuareg-font-lock-operator">=</span>
  <span class="tuareg-font-lock-governing">let</span> <span class="variable-name">c </span><span class="tuareg-font-lock-operator">=</span> new_circuit <span class="tuareg-font-lock-operator">()</span> <span class="tuareg-font-lock-governing">in</span>
  <span class="tuareg-font-lock-governing">let</span> <span class="variable-name">w1</span><span class="tuareg-font-lock-operator">,</span><span class="variable-name"> w2</span><span class="tuareg-font-lock-operator">,</span><span class="variable-name"> io</span><span class="tuareg-font-lock-operator">,</span><span class="variable-name"> vt</span><span class="tuareg-font-lock-operator">,</span><span class="variable-name"> rs</span><span class="tuareg-font-lock-operator">,</span><span class="variable-name"> cpi</span><span class="tuareg-font-lock-operator">,</span><span class="variable-name"> rload</span><span class="tuareg-font-lock-operator">,</span><span class="variable-name"> beta</span><span class="tuareg-font-lock-operator">,</span><span class="variable-name"> a1</span><span class="tuareg-font-lock-operator">,</span><span class="variable-name"> a2 </span><span class="tuareg-font-lock-operator">=</span>
    2. <span class="tuareg-font-lock-operator">*.</span> pi <span class="tuareg-font-lock-operator">*.</span> 10e3<span class="tuareg-font-lock-operator">,</span> 2. <span class="tuareg-font-lock-operator">*.</span> pi <span class="tuareg-font-lock-operator">*.</span> 10.1e3<span class="tuareg-font-lock-operator">,</span> 1e<span class="tuareg-font-lock-operator">-</span>15<span class="tuareg-font-lock-operator">,</span> 25e<span class="tuareg-font-lock-operator">-</span>3<span class="tuareg-font-lock-operator">,</span> 50.<span class="tuareg-font-lock-operator">,</span>
    1e<span class="tuareg-font-lock-operator">-</span>12<span class="tuareg-font-lock-operator">,</span> 10e3<span class="tuareg-font-lock-operator">,</span> 100.<span class="tuareg-font-lock-operator">,</span> 1e<span class="tuareg-font-lock-operator">-</span>3<span class="tuareg-font-lock-operator">,</span> 1e<span class="tuareg-font-lock-operator">-</span>4 <span class="tuareg-font-lock-governing">in</span>
  c<span class="tuareg-font-lock-operator">#</span>isrc 1 0 <span class="tuareg-font-lock-operator">~</span><span class="variable-name">id</span><span class="tuareg-font-lock-operator">:</span><span class="type">50 </span><span class="tuareg-font-lock-operator">~</span><span class="variable-name">ac</span><span class="tuareg-font-lock-operator">:(</span><span class="type">Source</span>.<span class="type">AC</span>.vac <span class="tuareg-font-lock-operator">~</span><span class="variable-name">freq</span><span class="tuareg-font-lock-operator">:</span><span class="type">w1 </span><span class="tuareg-font-lock-operator">~</span><span class="variable-name">mag</span><span class="tuareg-font-lock-operator">:</span><span class="type">a1 </span><span class="tuareg-font-lock-operator">());</span>
  c<span class="tuareg-font-lock-operator">#</span>isrc 1 0 <span class="tuareg-font-lock-operator">~</span><span class="variable-name">id</span><span class="tuareg-font-lock-operator">:</span><span class="type">60 </span><span class="tuareg-font-lock-operator">~</span><span class="variable-name">ac</span><span class="tuareg-font-lock-operator">:(</span><span class="type">Source</span>.<span class="type">AC</span>.vac <span class="tuareg-font-lock-operator">~</span><span class="variable-name">freq</span><span class="tuareg-font-lock-operator">:</span><span class="type">w2 </span><span class="tuareg-font-lock-operator">~</span><span class="variable-name">mag</span><span class="tuareg-font-lock-operator">:</span><span class="type">a2 </span><span class="tuareg-font-lock-operator">());</span>
  c<span class="tuareg-font-lock-operator">#</span>res 1 0 <span class="tuareg-font-lock-operator">~</span><span class="variable-name">r</span><span class="tuareg-font-lock-operator">:</span><span class="type">rs</span><span class="tuareg-font-lock-operator">;</span>
  c<span class="tuareg-font-lock-operator">#</span>cap 1 0 <span class="tuareg-font-lock-operator">~</span><span class="variable-name">c</span><span class="tuareg-font-lock-operator">:</span><span class="type">cpi</span><span class="tuareg-font-lock-operator">;</span>
  <span class="type"><span class="isearch"><span class="lazy-highlight">Diode</span></span></span>.diode_subckt c <span class="tuareg-font-lock-operator">~</span><span class="variable-name">nb</span><span class="tuareg-font-lock-operator">:</span><span class="type">2 </span><span class="tuareg-font-lock-operator">~</span><span class="variable-name">ne</span><span class="tuareg-font-lock-operator">:</span><span class="type">0</span><span class="tuareg-font-lock-operator">;</span>
  c<span class="tuareg-font-lock-operator">#</span>cccs 2 0 <span class="tuareg-font-lock-operator">~</span><span class="variable-name">id</span><span class="tuareg-font-lock-operator">:</span><span class="type">70 </span><span class="tuareg-font-lock-operator">~</span><span class="variable-name">ref1</span><span class="tuareg-font-lock-operator">:</span><span class="type">1 </span><span class="tuareg-font-lock-operator">~</span><span class="variable-name">ref2</span><span class="tuareg-font-lock-operator">:</span><span class="type">2 </span><span class="tuareg-font-lock-operator">~</span><span class="variable-name">gain</span><span class="tuareg-font-lock-operator">:</span><span class="type">beta</span><span class="tuareg-font-lock-operator">;</span>
  c<span class="tuareg-font-lock-operator">#</span>res 2 0 <span class="tuareg-font-lock-operator">~</span><span class="variable-name">r</span><span class="tuareg-font-lock-operator">:</span><span class="type">rload</span><span class="tuareg-font-lock-operator">;</span>
  c<span class="tuareg-font-lock-operator">#</span>multiHB <span class="string">"HB"</span> <span class="tuareg-font-lock-operator">~</span><span class="variable-name">k1</span><span class="tuareg-font-lock-operator">:</span><span class="type">5 </span><span class="tuareg-font-lock-operator">~</span>w1 <span class="tuareg-font-lock-operator">~</span><span class="variable-name">k2</span><span class="tuareg-font-lock-operator">:</span><span class="type">2 </span><span class="tuareg-font-lock-operator">~</span>w2<span class="tuareg-font-lock-operator">;</span>

  printf <span class="string">"|Vout(w1)|: %g\n%!"</span> <span class="tuareg-font-lock-operator">(</span>c<span class="tuareg-font-lock-operator">#</span>vm <span class="string">"HB"</span> 2 <span class="tuareg-font-lock-operator">~</span><span class="variable-name">f</span><span class="tuareg-font-lock-operator">:</span><span class="type">w1</span><span class="tuareg-font-lock-operator">);</span>
  printf <span class="string">"|Vout(w2)|: %g\n%!"</span> <span class="tuareg-font-lock-operator">(</span>c<span class="tuareg-font-lock-operator">#</span>vm <span class="string">"HB"</span> 2 <span class="tuareg-font-lock-operator">~</span><span class="variable-name">f</span><span class="tuareg-font-lock-operator">:</span><span class="type">w2</span><span class="tuareg-font-lock-operator">);</span>
  printf <span class="string">"|IM|: %g\n%!"</span> <span class="tuareg-font-lock-operator">(</span>c<span class="tuareg-font-lock-operator">#</span>vm <span class="string">"HB"</span> 2 <span class="tuareg-font-lock-operator">~</span><span class="variable-name">f</span><span class="tuareg-font-lock-operator">:(</span><span class="type">2. </span><span class="tuareg-font-lock-operator">*.</span><span class="type"> w1 </span><span class="tuareg-font-lock-operator">-.</span><span class="type"> w2</span><span class="tuareg-font-lock-operator">))</span></pre>
