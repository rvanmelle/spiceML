    <pre>
<span class="tuareg-font-lock-governing">let</span> <span class="function-name">rads_of_degrees</span><span class="variable-name"> x </span><span class="tuareg-font-lock-operator">=</span> 2. <span class="tuareg-font-lock-operator">*.</span> pi <span class="tuareg-font-lock-operator">*.</span> x

<span class="comment">(* Constants that we use through the routines here *)</span>
<span class="tuareg-font-lock-governing">let</span> <span class="variable-name">w1</span><span class="tuareg-font-lock-operator">,</span><span class="variable-name"> w2</span><span class="tuareg-font-lock-operator">,</span><span class="variable-name"> io</span><span class="tuareg-font-lock-operator">,</span><span class="variable-name"> vt</span><span class="tuareg-font-lock-operator">,</span><span class="variable-name"> rs</span><span class="tuareg-font-lock-operator">,</span><span class="variable-name"> cpi</span><span class="tuareg-font-lock-operator">,</span><span class="variable-name"> rload</span><span class="tuareg-font-lock-operator">,</span><span class="variable-name"> beta</span><span class="tuareg-font-lock-operator">,</span><span class="variable-name"> a1</span><span class="tuareg-font-lock-operator">,</span><span class="variable-name"> a2 </span><span class="tuareg-font-lock-operator">=</span>
  <span class="tuareg-font-lock-operator">(</span>rads_of_degrees 10e3<span class="tuareg-font-lock-operator">),</span> <span class="tuareg-font-lock-operator">(</span>rads_of_degrees 10.1e3<span class="tuareg-font-lock-operator">),</span> 1e<span class="tuareg-font-lock-operator">-</span>15<span class="tuareg-font-lock-operator">,</span> 25e<span class="tuareg-font-lock-operator">-</span>3<span class="tuareg-font-lock-operator">,</span> 50.<span class="tuareg-font-lock-operator">,</span>
  1e<span class="tuareg-font-lock-operator">-</span>12<span class="tuareg-font-lock-operator">,</span> 10e3<span class="tuareg-font-lock-operator">,</span> 100.<span class="tuareg-font-lock-operator">,</span> 1e<span class="tuareg-font-lock-operator">-</span>3<span class="tuareg-font-lock-operator">,</span> 1e<span class="tuareg-font-lock-operator">-</span>4<span class="tuareg-font-lock-operator">;;</span>

<span class="tuareg-font-lock-governing">let</span> <span class="function-name">frange</span><span class="variable-name"> start stop iter </span><span class="tuareg-font-lock-operator">=</span>
  <span class="tuareg-font-lock-governing">let</span> <span class="tuareg-font-lock-governing">rec</span> <span class="function-name">generate</span><span class="variable-name"> cur </span><span class="tuareg-font-lock-operator">=</span>
    <span class="keyword">if</span> cur <span class="tuareg-font-lock-operator">&gt;</span> stop <span class="keyword">then</span> <span class="tuareg-font-lock-operator">[]</span> <span class="keyword">else</span> cur <span class="tuareg-font-lock-operator">::</span> <span class="tuareg-font-lock-operator">(</span>generate <span class="tuareg-font-lock-operator">(</span>cur <span class="tuareg-font-lock-operator">+.</span> iter<span class="tuareg-font-lock-operator">))</span> <span class="tuareg-font-lock-governing">in</span>
  <span class="tuareg-font-lock-governing">let</span> <span class="variable-name">vals </span><span class="tuareg-font-lock-operator">=</span> <span class="type">Array</span>.of_list <span class="tuareg-font-lock-operator">(</span>generate start<span class="tuareg-font-lock-operator">)</span> <span class="tuareg-font-lock-governing">in</span>
  farray_of_array vals

<span class="tuareg-font-lock-governing">let</span> <span class="function-name">plot_response</span><span class="variable-name"> </span><span class="tuareg-font-lock-operator">()</span><span class="variable-name"> </span><span class="tuareg-font-lock-operator">=</span>
  <span class="tuareg-font-lock-governing">let</span> <span class="variable-name">g1 </span><span class="tuareg-font-lock-operator">=</span> io <span class="tuareg-font-lock-operator">/.</span> vt
  <span class="tuareg-font-lock-governing">and</span> <span class="variable-name">g2 </span><span class="tuareg-font-lock-operator">=</span> io <span class="tuareg-font-lock-operator">/.</span> <span class="tuareg-font-lock-operator">(</span>2. <span class="tuareg-font-lock-operator">*.</span> <span class="tuareg-font-lock-operator">(</span>vt <span class="tuareg-font-lock-operator">**</span> 2.<span class="tuareg-font-lock-operator">))</span>
  <span class="tuareg-font-lock-governing">and</span> <span class="variable-name">g3 </span><span class="tuareg-font-lock-operator">=</span> io <span class="tuareg-font-lock-operator">/.</span> <span class="tuareg-font-lock-operator">(</span>6. <span class="tuareg-font-lock-operator">*.</span> <span class="tuareg-font-lock-operator">(</span>vt <span class="tuareg-font-lock-operator">**</span> 3.<span class="tuareg-font-lock-operator">))</span>
  <span class="tuareg-font-lock-governing">in</span>
  <span class="tuareg-font-lock-governing">let</span> <span class="function-name">z_cpi</span><span class="variable-name"> w </span><span class="tuareg-font-lock-operator">=</span> <span class="type">Complex</span>.inv <span class="tuareg-font-lock-operator">(</span>complex 0. <span class="tuareg-font-lock-operator">(</span>w <span class="tuareg-font-lock-operator">*.</span> cpi<span class="tuareg-font-lock-operator">))</span> <span class="tuareg-font-lock-governing">in</span>
  <span class="tuareg-font-lock-governing">let</span> <span class="function-name">z1</span><span class="variable-name"> w </span><span class="tuareg-font-lock-operator">=</span>
    <span class="tuareg-font-lock-governing">let</span> <span class="variable-name">term1 </span><span class="tuareg-font-lock-operator">=</span> <span class="type">Complex</span>.inv <span class="tuareg-font-lock-operator">(</span>z_cpi w<span class="tuareg-font-lock-operator">)</span>
    <span class="tuareg-font-lock-governing">and</span> <span class="variable-name">term2 </span><span class="tuareg-font-lock-operator">=</span> complex g1 0. 
    <span class="tuareg-font-lock-governing">and</span> <span class="variable-name">term3 </span><span class="tuareg-font-lock-operator">=</span> complex <span class="tuareg-font-lock-operator">(</span>1. <span class="tuareg-font-lock-operator">/.</span> rs<span class="tuareg-font-lock-operator">)</span> 0.
    <span class="tuareg-font-lock-governing">in</span>
    <span class="type">Complex</span>.inv <span class="tuareg-font-lock-operator">(</span>term1 <span class="tuareg-font-lock-operator">$+</span> term2 <span class="tuareg-font-lock-operator">$+</span> term3<span class="tuareg-font-lock-operator">)</span>
  <span class="tuareg-font-lock-governing">in</span> 
  <span class="tuareg-font-lock-governing">let</span> <span class="function-name">z2</span><span class="variable-name"> w </span><span class="tuareg-font-lock-operator">=</span> z1 w <span class="tuareg-font-lock-governing">in</span>
  <span class="tuareg-font-lock-governing">let</span> <span class="variable-name">coeff </span><span class="tuareg-font-lock-operator">=</span> complex <span class="tuareg-font-lock-operator">((-.</span>1.<span class="tuareg-font-lock-operator">)</span> <span class="tuareg-font-lock-operator">*.</span> beta <span class="tuareg-font-lock-operator">*.</span> rload <span class="tuareg-font-lock-operator">*.</span> g1<span class="tuareg-font-lock-operator">)</span> 0. <span class="tuareg-font-lock-governing">in</span>
  <span class="comment">(* First, second, and third order kernerls *)</span>
  <span class="tuareg-font-lock-governing">let</span> <span class="function-name">kernel1</span><span class="variable-name"> w </span><span class="tuareg-font-lock-operator">=</span> coeff <span class="tuareg-font-lock-operator">$*</span> <span class="tuareg-font-lock-operator">(</span>z1 w<span class="tuareg-font-lock-operator">)</span>
  <span class="tuareg-font-lock-governing">and</span> <span class="function-name">kernel2</span><span class="variable-name"> w1 w2 </span><span class="tuareg-font-lock-operator">=</span>
    <span class="tuareg-font-lock-operator">(</span>complex <span class="tuareg-font-lock-operator">(-.</span>1. <span class="tuareg-font-lock-operator">*.</span> g2<span class="tuareg-font-lock-operator">)</span> 0.<span class="tuareg-font-lock-operator">)</span> <span class="tuareg-font-lock-operator">$*</span> coeff <span class="tuareg-font-lock-operator">$*</span> <span class="tuareg-font-lock-operator">(</span>z2 w1<span class="tuareg-font-lock-operator">)</span> <span class="tuareg-font-lock-operator">$*</span> <span class="tuareg-font-lock-operator">(</span>z2 w2<span class="tuareg-font-lock-operator">)</span> <span class="tuareg-font-lock-operator">$*</span> <span class="tuareg-font-lock-operator">(</span>z1 <span class="tuareg-font-lock-operator">(</span>w1 <span class="tuareg-font-lock-operator">+.</span> w2<span class="tuareg-font-lock-operator">))</span>
  <span class="tuareg-font-lock-governing">and</span> <span class="function-name">kernel3</span><span class="variable-name"> w1 w2 w3 </span><span class="tuareg-font-lock-operator">=</span>
    <span class="tuareg-font-lock-operator">(</span>complex g3 0.<span class="tuareg-font-lock-operator">)</span> <span class="tuareg-font-lock-operator">$*</span> coeff <span class="tuareg-font-lock-operator">$*</span> <span class="tuareg-font-lock-operator">(</span>z2 w1<span class="tuareg-font-lock-operator">)</span> <span class="tuareg-font-lock-operator">$*</span> <span class="tuareg-font-lock-operator">(</span>z2 w2<span class="tuareg-font-lock-operator">)</span> <span class="tuareg-font-lock-operator">$*</span> <span class="tuareg-font-lock-operator">(</span>z2 w3<span class="tuareg-font-lock-operator">)</span> <span class="tuareg-font-lock-operator">$*</span> <span class="tuareg-font-lock-operator">(</span>z1 <span class="tuareg-font-lock-operator">(</span>w1 <span class="tuareg-font-lock-operator">+.</span> w2 <span class="tuareg-font-lock-operator">+.</span> w3<span class="tuareg-font-lock-operator">))</span>
  <span class="tuareg-font-lock-governing">in</span>
  <span class="comment">(* First order reponse as a function of time t *)</span>
  <span class="tuareg-font-lock-governing">let</span> <span class="function-name">first_order</span><span class="variable-name"> t </span><span class="tuareg-font-lock-operator">:</span> <span class="type">Complex.t </span><span class="tuareg-font-lock-operator">=</span>
    <span class="tuareg-font-lock-governing">let</span> <span class="variable-name">t </span><span class="tuareg-font-lock-operator">=</span> complex t 0. <span class="tuareg-font-lock-governing">in</span>
    <span class="tuareg-font-lock-governing">let</span> <span class="function-name">term1</span><span class="variable-name"> k </span><span class="tuareg-font-lock-operator">=</span>
      <span class="tuareg-font-lock-governing">let</span> <span class="variable-name">w </span><span class="tuareg-font-lock-operator">=</span> <span class="tuareg-font-lock-operator">(</span>float k<span class="tuareg-font-lock-operator">)</span> <span class="tuareg-font-lock-operator">*.</span> w1 <span class="tuareg-font-lock-governing">in</span>
      <span class="tuareg-font-lock-operator">(</span>complex <span class="tuareg-font-lock-operator">(</span>0.5 <span class="tuareg-font-lock-operator">*.</span> a1<span class="tuareg-font-lock-operator">)</span> 0.<span class="tuareg-font-lock-operator">)</span> <span class="tuareg-font-lock-operator">$*</span> <span class="tuareg-font-lock-operator">(</span>kernel1 w<span class="tuareg-font-lock-operator">)</span> <span class="tuareg-font-lock-operator">$*</span>
        <span class="tuareg-font-lock-operator">(</span><span class="type">Complex</span>.exp <span class="tuareg-font-lock-operator">(</span>t <span class="tuareg-font-lock-operator">$*</span> <span class="tuareg-font-lock-operator">(</span>complex 0. w<span class="tuareg-font-lock-operator">)))</span>
    <span class="tuareg-font-lock-governing">and</span> <span class="function-name">term2</span><span class="variable-name"> k </span><span class="tuareg-font-lock-operator">=</span>
      <span class="tuareg-font-lock-governing">let</span> <span class="variable-name">w </span><span class="tuareg-font-lock-operator">=</span> <span class="tuareg-font-lock-operator">(</span>float k<span class="tuareg-font-lock-operator">)</span> <span class="tuareg-font-lock-operator">*.</span> w2 <span class="tuareg-font-lock-governing">in</span>
      <span class="tuareg-font-lock-operator">(</span>complex <span class="tuareg-font-lock-operator">(</span>0.5 <span class="tuareg-font-lock-operator">*.</span> a2<span class="tuareg-font-lock-operator">)</span> 0.<span class="tuareg-font-lock-operator">)</span> <span class="tuareg-font-lock-operator">$*</span> <span class="tuareg-font-lock-operator">(</span>kernel1 w<span class="tuareg-font-lock-operator">)</span> <span class="tuareg-font-lock-operator">$*</span>
        <span class="tuareg-font-lock-operator">(</span><span class="type">Complex</span>.exp <span class="tuareg-font-lock-operator">(</span>t <span class="tuareg-font-lock-operator">$*</span> <span class="tuareg-font-lock-operator">(</span>complex 0. w<span class="tuareg-font-lock-operator">)))</span>
    <span class="tuareg-font-lock-governing">in</span>
    <span class="tuareg-font-lock-operator">(</span>term1 1<span class="tuareg-font-lock-operator">)</span> <span class="tuareg-font-lock-operator">$+</span> <span class="tuareg-font-lock-operator">(</span>term1 <span class="tuareg-font-lock-operator">(-</span>1<span class="tuareg-font-lock-operator">))</span> <span class="tuareg-font-lock-operator">$+</span> <span class="tuareg-font-lock-operator">(</span>term2 1<span class="tuareg-font-lock-operator">)</span> <span class="tuareg-font-lock-operator">$+</span> <span class="tuareg-font-lock-operator">(</span>term2 <span class="tuareg-font-lock-operator">(-</span>1<span class="tuareg-font-lock-operator">))</span>
      <span class="comment">(* Second order reponse as a function of time t *)</span>
  <span class="tuareg-font-lock-governing">and</span> <span class="function-name">second_order</span><span class="variable-name"> t </span><span class="tuareg-font-lock-operator">=</span>
    <span class="tuareg-font-lock-governing">let</span> <span class="variable-name">t </span><span class="tuareg-font-lock-operator">=</span> complex t 0. <span class="tuareg-font-lock-governing">in</span>
    <span class="tuareg-font-lock-governing">let</span> <span class="function-name">term1</span><span class="variable-name"> k1 k2 </span><span class="tuareg-font-lock-operator">=</span>
      <span class="tuareg-font-lock-governing">let</span> <span class="variable-name">w1 </span><span class="tuareg-font-lock-operator">=</span> <span class="tuareg-font-lock-operator">(</span>float k1<span class="tuareg-font-lock-operator">)</span> <span class="tuareg-font-lock-operator">*.</span> w1
      <span class="tuareg-font-lock-governing">and</span> <span class="variable-name">w2 </span><span class="tuareg-font-lock-operator">=</span> <span class="tuareg-font-lock-operator">(</span>float k2<span class="tuareg-font-lock-operator">)</span> <span class="tuareg-font-lock-operator">*.</span> w1 <span class="tuareg-font-lock-governing">in</span>
      <span class="tuareg-font-lock-operator">(</span>complex <span class="tuareg-font-lock-operator">(</span>0.25 <span class="tuareg-font-lock-operator">*.</span> <span class="tuareg-font-lock-operator">(</span>a1 <span class="tuareg-font-lock-operator">**</span> 2.<span class="tuareg-font-lock-operator">))</span> 0.<span class="tuareg-font-lock-operator">)</span> <span class="tuareg-font-lock-operator">$*</span> <span class="tuareg-font-lock-operator">(</span>kernel2 w1 w2<span class="tuareg-font-lock-operator">)</span> <span class="tuareg-font-lock-operator">$*</span>
        <span class="tuareg-font-lock-operator">(</span><span class="type">Complex</span>.exp <span class="tuareg-font-lock-operator">(</span>t <span class="tuareg-font-lock-operator">$*</span> <span class="tuareg-font-lock-operator">(</span>complex 0. <span class="tuareg-font-lock-operator">(</span>w1 <span class="tuareg-font-lock-operator">+.</span> w2<span class="tuareg-font-lock-operator">))))</span>
    <span class="tuareg-font-lock-governing">and</span> <span class="function-name">term2</span><span class="variable-name"> k1 k2 </span><span class="tuareg-font-lock-operator">=</span>
      <span class="tuareg-font-lock-governing">let</span> <span class="variable-name">w1 </span><span class="tuareg-font-lock-operator">=</span> <span class="tuareg-font-lock-operator">(</span>float k1<span class="tuareg-font-lock-operator">)</span> <span class="tuareg-font-lock-operator">*.</span> w2
      <span class="tuareg-font-lock-governing">and</span> <span class="variable-name">w2 </span><span class="tuareg-font-lock-operator">=</span> <span class="tuareg-font-lock-operator">(</span>float k2<span class="tuareg-font-lock-operator">)</span> <span class="tuareg-font-lock-operator">*.</span> w2 <span class="tuareg-font-lock-governing">in</span>
      <span class="tuareg-font-lock-operator">(</span>complex <span class="tuareg-font-lock-operator">(</span>0.25 <span class="tuareg-font-lock-operator">*.</span> <span class="tuareg-font-lock-operator">(</span>a1 <span class="tuareg-font-lock-operator">**</span> 2.<span class="tuareg-font-lock-operator">))</span> 0.<span class="tuareg-font-lock-operator">)</span> <span class="tuareg-font-lock-operator">$*</span> <span class="tuareg-font-lock-operator">(</span>kernel2 w1 w2<span class="tuareg-font-lock-operator">)</span> <span class="tuareg-font-lock-operator">$*</span>
        <span class="tuareg-font-lock-operator">(</span><span class="type">Complex</span>.exp <span class="tuareg-font-lock-operator">(</span>t <span class="tuareg-font-lock-operator">$*</span> <span class="tuareg-font-lock-operator">(</span>complex 0. <span class="tuareg-font-lock-operator">(</span>w1 <span class="tuareg-font-lock-operator">+.</span> w2<span class="tuareg-font-lock-operator">))))</span>
    <span class="tuareg-font-lock-governing">and</span> <span class="function-name">term3</span><span class="variable-name"> k1 k2 </span><span class="tuareg-font-lock-operator">=</span>
      <span class="tuareg-font-lock-governing">let</span> <span class="variable-name">w1 </span><span class="tuareg-font-lock-operator">=</span> <span class="tuareg-font-lock-operator">(</span>float k1<span class="tuareg-font-lock-operator">)</span> <span class="tuareg-font-lock-operator">*.</span> w1
      <span class="tuareg-font-lock-governing">and</span> <span class="variable-name">w2 </span><span class="tuareg-font-lock-operator">=</span> <span class="tuareg-font-lock-operator">(</span>float k2<span class="tuareg-font-lock-operator">)</span> <span class="tuareg-font-lock-operator">*.</span> w2 <span class="tuareg-font-lock-governing">in</span>
      <span class="tuareg-font-lock-operator">(</span>complex <span class="tuareg-font-lock-operator">(</span>0.5 <span class="tuareg-font-lock-operator">*.</span> a1 <span class="tuareg-font-lock-operator">*.</span> a2<span class="tuareg-font-lock-operator">)</span> 0.<span class="tuareg-font-lock-operator">)</span> <span class="tuareg-font-lock-operator">$*</span> <span class="tuareg-font-lock-operator">(</span>kernel2 w1 w2<span class="tuareg-font-lock-operator">)</span> <span class="tuareg-font-lock-operator">$*</span>
        <span class="tuareg-font-lock-operator">(</span><span class="type">Complex</span>.exp <span class="tuareg-font-lock-operator">(</span>t <span class="tuareg-font-lock-operator">$*</span> <span class="tuareg-font-lock-operator">(</span>complex 0. <span class="tuareg-font-lock-operator">(</span>w1 <span class="tuareg-font-lock-operator">+.</span> w2<span class="tuareg-font-lock-operator">))))</span>
    <span class="tuareg-font-lock-governing">and</span> <span class="function-name">all_terms</span><span class="variable-name"> </span><span class="tuareg-font-lock-operator">(</span><span class="variable-name">fn</span><span class="tuareg-font-lock-operator">:</span> <span class="type">int </span><span class="tuareg-font-lock-operator">-&gt;</span><span class="type"> int </span><span class="tuareg-font-lock-operator">-&gt;</span><span class="type"> Complex.t</span><span class="tuareg-font-lock-operator">)</span> <span class="tuareg-font-lock-operator">:</span> <span class="type">Complex.t </span><span class="tuareg-font-lock-operator">=</span>
      <span class="tuareg-font-lock-operator">(</span>fn 1 1<span class="tuareg-font-lock-operator">)</span> <span class="tuareg-font-lock-operator">$+</span> <span class="tuareg-font-lock-operator">(</span>fn 1 <span class="tuareg-font-lock-operator">(-</span>1<span class="tuareg-font-lock-operator">))</span> <span class="tuareg-font-lock-operator">$+</span> <span class="tuareg-font-lock-operator">(</span>fn <span class="tuareg-font-lock-operator">(-</span>1<span class="tuareg-font-lock-operator">)</span> 1<span class="tuareg-font-lock-operator">)</span> <span class="tuareg-font-lock-operator">$+</span> <span class="tuareg-font-lock-operator">(</span>fn <span class="tuareg-font-lock-operator">(-</span>1<span class="tuareg-font-lock-operator">)</span> <span class="tuareg-font-lock-operator">(-</span>1<span class="tuareg-font-lock-operator">))</span> <span class="tuareg-font-lock-governing">in</span>
    <span class="tuareg-font-lock-operator">(</span>all_terms term1<span class="tuareg-font-lock-operator">)</span> <span class="tuareg-font-lock-operator">$+</span> <span class="tuareg-font-lock-operator">(</span>all_terms term2<span class="tuareg-font-lock-operator">)</span> <span class="tuareg-font-lock-operator">$+</span> <span class="tuareg-font-lock-operator">(</span>all_terms term3<span class="tuareg-font-lock-operator">)</span>
      <span class="comment">(* Third order reponse as a function of time t *)</span>
  <span class="tuareg-font-lock-governing">and</span> <span class="function-name">third_order</span><span class="variable-name"> t </span><span class="tuareg-font-lock-operator">=</span>
    <span class="tuareg-font-lock-governing">let</span> <span class="variable-name">t </span><span class="tuareg-font-lock-operator">=</span> complex t 0. <span class="tuareg-font-lock-governing">in</span>
    <span class="tuareg-font-lock-governing">let</span> <span class="function-name">term1</span><span class="variable-name"> k1 k2 k3 </span><span class="tuareg-font-lock-operator">=</span>
      <span class="tuareg-font-lock-governing">let</span> <span class="variable-name">w1</span><span class="tuareg-font-lock-operator">,</span><span class="variable-name"> w2</span><span class="tuareg-font-lock-operator">,</span><span class="variable-name"> w3 </span><span class="tuareg-font-lock-operator">=</span> <span class="tuareg-font-lock-operator">(</span>float k1<span class="tuareg-font-lock-operator">)</span> <span class="tuareg-font-lock-operator">*.</span> w1<span class="tuareg-font-lock-operator">,</span> <span class="tuareg-font-lock-operator">(</span>float k2<span class="tuareg-font-lock-operator">)</span> <span class="tuareg-font-lock-operator">*.</span> w1<span class="tuareg-font-lock-operator">,</span> <span class="tuareg-font-lock-operator">(</span>float k3<span class="tuareg-font-lock-operator">)</span> <span class="tuareg-font-lock-operator">*.</span> w1 <span class="tuareg-font-lock-governing">in</span>
      <span class="tuareg-font-lock-operator">(</span>complex <span class="tuareg-font-lock-operator">(</span>0.125 <span class="tuareg-font-lock-operator">*.</span> <span class="tuareg-font-lock-operator">(</span>a1 <span class="tuareg-font-lock-operator">**</span> 3.<span class="tuareg-font-lock-operator">))</span> 0.<span class="tuareg-font-lock-operator">)</span> <span class="tuareg-font-lock-operator">$*</span> <span class="tuareg-font-lock-operator">(</span>kernel3 w1 w2 w3<span class="tuareg-font-lock-operator">)</span> <span class="tuareg-font-lock-operator">$*</span>
        <span class="tuareg-font-lock-operator">(</span><span class="type">Complex</span>.exp <span class="tuareg-font-lock-operator">(</span>t <span class="tuareg-font-lock-operator">$*</span> <span class="tuareg-font-lock-operator">(</span>complex 0. <span class="tuareg-font-lock-operator">(</span>w1 <span class="tuareg-font-lock-operator">+.</span> w2 <span class="tuareg-font-lock-operator">+.</span> w3<span class="tuareg-font-lock-operator">))))</span>
    <span class="tuareg-font-lock-governing">and</span> <span class="function-name">term2</span><span class="variable-name"> k1 k2 k3 </span><span class="tuareg-font-lock-operator">=</span>
      <span class="tuareg-font-lock-governing">let</span> <span class="variable-name">w1</span><span class="tuareg-font-lock-operator">,</span><span class="variable-name"> w2</span><span class="tuareg-font-lock-operator">,</span><span class="variable-name"> w3 </span><span class="tuareg-font-lock-operator">=</span> <span class="tuareg-font-lock-operator">(</span>float k1<span class="tuareg-font-lock-operator">)</span> <span class="tuareg-font-lock-operator">*.</span> w1<span class="tuareg-font-lock-operator">,</span> <span class="tuareg-font-lock-operator">(</span>float k2<span class="tuareg-font-lock-operator">)</span> <span class="tuareg-font-lock-operator">*.</span> w1<span class="tuareg-font-lock-operator">,</span> <span class="tuareg-font-lock-operator">(</span>float k3<span class="tuareg-font-lock-operator">)</span> <span class="tuareg-font-lock-operator">*.</span> w2 <span class="tuareg-font-lock-governing">in</span>
      <span class="tuareg-font-lock-operator">(</span>complex <span class="tuareg-font-lock-operator">(</span>3. <span class="tuareg-font-lock-operator">*.</span> 0.125 <span class="tuareg-font-lock-operator">*.</span> <span class="tuareg-font-lock-operator">(</span>a1 <span class="tuareg-font-lock-operator">**</span> 2.<span class="tuareg-font-lock-operator">)</span> <span class="tuareg-font-lock-operator">*.</span> a2<span class="tuareg-font-lock-operator">)</span> 0.<span class="tuareg-font-lock-operator">)</span> <span class="tuareg-font-lock-operator">$*</span> <span class="tuareg-font-lock-operator">(</span>kernel3 w1 w2 w3<span class="tuareg-font-lock-operator">)</span> <span class="tuareg-font-lock-operator">$*</span>
        <span class="tuareg-font-lock-operator">(</span><span class="type">Complex</span>.exp <span class="tuareg-font-lock-operator">(</span>t <span class="tuareg-font-lock-operator">$*</span> <span class="tuareg-font-lock-operator">(</span>complex 0. <span class="tuareg-font-lock-operator">(</span>w1 <span class="tuareg-font-lock-operator">+.</span> w2 <span class="tuareg-font-lock-operator">+.</span> w3<span class="tuareg-font-lock-operator">))))</span>
    <span class="tuareg-font-lock-governing">and</span> <span class="function-name">term3</span><span class="variable-name"> k1 k2 k3 </span><span class="tuareg-font-lock-operator">=</span>
      <span class="tuareg-font-lock-governing">let</span> <span class="variable-name">w1</span><span class="tuareg-font-lock-operator">,</span><span class="variable-name"> w2</span><span class="tuareg-font-lock-operator">,</span><span class="variable-name"> w3 </span><span class="tuareg-font-lock-operator">=</span> <span class="tuareg-font-lock-operator">(</span>float k1<span class="tuareg-font-lock-operator">)</span> <span class="tuareg-font-lock-operator">*.</span> w1<span class="tuareg-font-lock-operator">,</span> <span class="tuareg-font-lock-operator">(</span>float k2<span class="tuareg-font-lock-operator">)</span> <span class="tuareg-font-lock-operator">*.</span> w2<span class="tuareg-font-lock-operator">,</span> <span class="tuareg-font-lock-operator">(</span>float k3<span class="tuareg-font-lock-operator">)</span> <span class="tuareg-font-lock-operator">*.</span> w2 <span class="tuareg-font-lock-governing">in</span>
      <span class="tuareg-font-lock-operator">(</span>complex <span class="tuareg-font-lock-operator">(</span>3. <span class="tuareg-font-lock-operator">*.</span> 0.125 <span class="tuareg-font-lock-operator">*.</span> <span class="tuareg-font-lock-operator">(</span>a2 <span class="tuareg-font-lock-operator">**</span> 2.<span class="tuareg-font-lock-operator">)</span> <span class="tuareg-font-lock-operator">*.</span> a1<span class="tuareg-font-lock-operator">)</span> 0.<span class="tuareg-font-lock-operator">)</span> <span class="tuareg-font-lock-operator">$*</span> <span class="tuareg-font-lock-operator">(</span>kernel3 w1 w2 w3<span class="tuareg-font-lock-operator">)</span> <span class="tuareg-font-lock-operator">$*</span>
        <span class="tuareg-font-lock-operator">(</span><span class="type">Complex</span>.exp <span class="tuareg-font-lock-operator">(</span>t <span class="tuareg-font-lock-operator">$*</span> <span class="tuareg-font-lock-operator">(</span>complex 0. <span class="tuareg-font-lock-operator">(</span>w1 <span class="tuareg-font-lock-operator">+.</span> w2 <span class="tuareg-font-lock-operator">+.</span> w3<span class="tuareg-font-lock-operator">))))</span>
    <span class="tuareg-font-lock-governing">and</span> <span class="function-name">term4</span><span class="variable-name"> k1 k2 k3 </span><span class="tuareg-font-lock-operator">=</span>
      <span class="tuareg-font-lock-governing">let</span> <span class="variable-name">w1</span><span class="tuareg-font-lock-operator">,</span><span class="variable-name"> w2</span><span class="tuareg-font-lock-operator">,</span><span class="variable-name"> w3 </span><span class="tuareg-font-lock-operator">=</span> <span class="tuareg-font-lock-operator">(</span>float k1<span class="tuareg-font-lock-operator">)</span> <span class="tuareg-font-lock-operator">*.</span> w2<span class="tuareg-font-lock-operator">,</span> <span class="tuareg-font-lock-operator">(</span>float k2<span class="tuareg-font-lock-operator">)</span> <span class="tuareg-font-lock-operator">*.</span> w2<span class="tuareg-font-lock-operator">,</span> <span class="tuareg-font-lock-operator">(</span>float k3<span class="tuareg-font-lock-operator">)</span> <span class="tuareg-font-lock-operator">*.</span> w2 <span class="tuareg-font-lock-governing">in</span>
      <span class="tuareg-font-lock-operator">(</span>complex <span class="tuareg-font-lock-operator">(</span>0.125 <span class="tuareg-font-lock-operator">*.</span> <span class="tuareg-font-lock-operator">(</span>a2 <span class="tuareg-font-lock-operator">**</span> 3.<span class="tuareg-font-lock-operator">))</span> 0.<span class="tuareg-font-lock-operator">)</span> <span class="tuareg-font-lock-operator">$*</span> <span class="tuareg-font-lock-operator">(</span>kernel3 w1 w2 w3<span class="tuareg-font-lock-operator">)</span> <span class="tuareg-font-lock-operator">$*</span>
        <span class="tuareg-font-lock-operator">(</span><span class="type">Complex</span>.exp <span class="tuareg-font-lock-operator">(</span>t <span class="tuareg-font-lock-operator">$*</span> <span class="tuareg-font-lock-operator">(</span>complex 0. <span class="tuareg-font-lock-operator">(</span>w1 <span class="tuareg-font-lock-operator">+.</span> w2 <span class="tuareg-font-lock-operator">+.</span> w3<span class="tuareg-font-lock-operator">))))</span>
    <span class="tuareg-font-lock-governing">and</span> <span class="function-name">all_terms</span><span class="variable-name"> fn </span><span class="tuareg-font-lock-operator">=</span>
      <span class="tuareg-font-lock-operator">(</span>fn 1 1 1<span class="tuareg-font-lock-operator">)</span> <span class="tuareg-font-lock-operator">$+</span> <span class="tuareg-font-lock-operator">(</span>fn 1 1 <span class="tuareg-font-lock-operator">(-</span>1<span class="tuareg-font-lock-operator">))</span> <span class="tuareg-font-lock-operator">$+</span> <span class="tuareg-font-lock-operator">(</span>fn 1 <span class="tuareg-font-lock-operator">(-</span>1<span class="tuareg-font-lock-operator">)</span> 1<span class="tuareg-font-lock-operator">)</span> <span class="tuareg-font-lock-operator">$+</span> <span class="tuareg-font-lock-operator">(</span>fn 1 <span class="tuareg-font-lock-operator">(-</span>1<span class="tuareg-font-lock-operator">)</span> <span class="tuareg-font-lock-operator">(-</span>1<span class="tuareg-font-lock-operator">))</span> <span class="tuareg-font-lock-operator">$+</span>
        <span class="tuareg-font-lock-operator">(</span>fn <span class="tuareg-font-lock-operator">(-</span>1<span class="tuareg-font-lock-operator">)</span> 1 1<span class="tuareg-font-lock-operator">)</span> <span class="tuareg-font-lock-operator">$+</span> <span class="tuareg-font-lock-operator">(</span>fn <span class="tuareg-font-lock-operator">(-</span>1<span class="tuareg-font-lock-operator">)</span> 1 <span class="tuareg-font-lock-operator">(-</span>1<span class="tuareg-font-lock-operator">))</span> <span class="tuareg-font-lock-operator">$+</span> <span class="tuareg-font-lock-operator">(</span>fn <span class="tuareg-font-lock-operator">(-</span>1<span class="tuareg-font-lock-operator">)</span> <span class="tuareg-font-lock-operator">(-</span>1<span class="tuareg-font-lock-operator">)</span> 1<span class="tuareg-font-lock-operator">)</span> <span class="tuareg-font-lock-operator">$+</span> <span class="tuareg-font-lock-operator">(</span>fn <span class="tuareg-font-lock-operator">(-</span>1<span class="tuareg-font-lock-operator">)</span> <span class="tuareg-font-lock-operator">(-</span>1<span class="tuareg-font-lock-operator">)</span> <span class="tuareg-font-lock-operator">(-</span>1<span class="tuareg-font-lock-operator">))</span>
    <span class="tuareg-font-lock-governing">in</span>
    <span class="tuareg-font-lock-operator">(</span>all_terms term1<span class="tuareg-font-lock-operator">)</span> <span class="tuareg-font-lock-operator">$+</span> <span class="tuareg-font-lock-operator">(</span>all_terms term2<span class="tuareg-font-lock-operator">)</span> <span class="tuareg-font-lock-operator">$+</span> <span class="tuareg-font-lock-operator">(</span>all_terms term3<span class="tuareg-font-lock-operator">)</span> <span class="tuareg-font-lock-operator">$+</span> <span class="tuareg-font-lock-operator">(</span>all_terms term4<span class="tuareg-font-lock-operator">)</span>
  <span class="tuareg-font-lock-governing">in</span>
  <span class="tuareg-font-lock-governing">let</span> <span class="variable-name">logx</span><span class="tuareg-font-lock-operator">,</span><span class="variable-name"> logy </span><span class="tuareg-font-lock-operator">=</span> <span class="constant">false</span><span class="tuareg-font-lock-operator">,</span> <span class="constant">false</span> <span class="tuareg-font-lock-governing">in</span>
  <span class="tuareg-font-lock-governing">let</span> <span class="variable-name">sweep </span><span class="tuareg-font-lock-operator">:</span> <span class="type">fvector </span><span class="tuareg-font-lock-operator">=</span> frange 0. 0.01 0.00001 <span class="tuareg-font-lock-governing">in</span>
  <span class="tuareg-font-lock-governing">let</span> <span class="function-name">trace</span><span class="variable-name"> fn </span><span class="tuareg-font-lock-operator">=</span> farray_map <span class="tuareg-font-lock-operator">(</span><span class="keyword">fun</span> <span class="variable-name">x </span><span class="tuareg-font-lock-operator">-&gt;</span> <span class="type">Complex</span>.norm <span class="tuareg-font-lock-operator">(</span>fn x<span class="tuareg-font-lock-operator">))</span> sweep <span class="tuareg-font-lock-governing">in</span>
  <span class="tuareg-font-lock-governing">let</span> <span class="variable-name">signal1 </span><span class="tuareg-font-lock-operator">=</span> <span class="tuareg-font-lock-operator">{</span>real_sweep <span class="tuareg-font-lock-operator">=</span> sweep<span class="tuareg-font-lock-operator">;</span> real_trace <span class="tuareg-font-lock-operator">=</span> trace first_order<span class="tuareg-font-lock-operator">}</span> <span class="tuareg-font-lock-governing">in</span>
  <span class="tuareg-font-lock-governing">let</span> <span class="variable-name">signal2 </span><span class="tuareg-font-lock-operator">=</span> <span class="tuareg-font-lock-operator">{</span>real_sweep <span class="tuareg-font-lock-operator">=</span> sweep<span class="tuareg-font-lock-operator">;</span> real_trace <span class="tuareg-font-lock-operator">=</span> trace second_order<span class="tuareg-font-lock-operator">}</span> <span class="tuareg-font-lock-governing">in</span>
  <span class="tuareg-font-lock-governing">let</span> <span class="variable-name">signal3 </span><span class="tuareg-font-lock-operator">=</span> <span class="tuareg-font-lock-operator">{</span>real_sweep <span class="tuareg-font-lock-operator">=</span> sweep<span class="tuareg-font-lock-operator">;</span> real_trace <span class="tuareg-font-lock-operator">=</span> trace third_order<span class="tuareg-font-lock-operator">}</span> <span class="tuareg-font-lock-governing">in</span>  
  <span class="tuareg-font-lock-governing">let</span> <span class="variable-name">wave1 </span><span class="tuareg-font-lock-operator">=</span> <span class="type">Ospi_waveform</span>.new_signal <span class="tuareg-font-lock-operator">~</span><span class="variable-name">name</span><span class="tuareg-font-lock-operator">:</span><span class="string">"1st Order Response"</span>
    <span class="tuareg-font-lock-operator">~</span><span class="variable-name">trace</span><span class="tuareg-font-lock-operator">:</span>`LinesPoints <span class="tuareg-font-lock-operator">~</span><span class="variable-name">lines</span><span class="tuareg-font-lock-operator">:</span>`Solid <span class="tuareg-font-lock-operator">~</span><span class="variable-name">points</span><span class="tuareg-font-lock-operator">:</span>`None signal1 <span class="tuareg-font-lock-governing">in</span>
  <span class="tuareg-font-lock-governing">let</span> <span class="variable-name">wave2 </span><span class="tuareg-font-lock-operator">=</span> <span class="type">Ospi_waveform</span>.new_signal <span class="tuareg-font-lock-operator">~</span><span class="variable-name">name</span><span class="tuareg-font-lock-operator">:</span><span class="string">"2nd Order Response"</span>
    <span class="tuareg-font-lock-operator">~</span><span class="variable-name">trace</span><span class="tuareg-font-lock-operator">:</span>`LinesPoints <span class="tuareg-font-lock-operator">~</span><span class="variable-name">lines</span><span class="tuareg-font-lock-operator">:</span>`Solid <span class="tuareg-font-lock-operator">~</span><span class="variable-name">points</span><span class="tuareg-font-lock-operator">:</span>`None signal2 <span class="tuareg-font-lock-governing">in</span>
  <span class="tuareg-font-lock-governing">let</span> <span class="variable-name">wave3 </span><span class="tuareg-font-lock-operator">=</span> <span class="type">Ospi_waveform</span>.new_signal <span class="tuareg-font-lock-operator">~</span><span class="variable-name">name</span><span class="tuareg-font-lock-operator">:</span><span class="string">"3rd Order Response"</span>
    <span class="tuareg-font-lock-operator">~</span><span class="variable-name">trace</span><span class="tuareg-font-lock-operator">:</span>`LinesPoints <span class="tuareg-font-lock-operator">~</span><span class="variable-name">lines</span><span class="tuareg-font-lock-operator">:</span>`Solid <span class="tuareg-font-lock-operator">~</span><span class="variable-name">points</span><span class="tuareg-font-lock-operator">:</span>`None signal3 <span class="tuareg-font-lock-governing">in</span>
  <span class="type">Plotter</span>.plot <span class="tuareg-font-lock-operator">~</span>logx <span class="tuareg-font-lock-operator">~</span>logy <span class="tuareg-font-lock-operator">[</span>wave1<span class="tuareg-font-lock-operator">];</span>
  <span class="type">Plotter</span>.plot <span class="tuareg-font-lock-operator">~</span>logx <span class="tuareg-font-lock-operator">~</span>logy <span class="tuareg-font-lock-operator">[</span>wave2<span class="tuareg-font-lock-operator">];</span>
  <span class="type">Plotter</span>.plot <span class="tuareg-font-lock-operator">~</span>logx <span class="tuareg-font-lock-operator">~</span>logy <span class="tuareg-font-lock-operator">[</span>wave3<span class="tuareg-font-lock-operator">]</span></pre>

