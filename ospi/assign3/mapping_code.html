    <pre>
<span class="comment">(* Performs a frequency mapping for the box-truncation defined by
   the ks.  Returns two association lists which can be used to look stuff
   up in either direction *)</span>
<span class="tuareg-font-lock-governing">let</span> <span class="function-name">frequency_mapping</span><span class="variable-name"> ks fs </span><span class="tuareg-font-lock-operator">=</span>
  <span class="tuareg-font-lock-governing">let</span> <span class="variable-name">trunc </span><span class="tuareg-font-lock-operator">=</span> box_truncation ks <span class="tuareg-font-lock-governing">in</span>
  <span class="tuareg-font-lock-governing">let</span> <span class="variable-name">ks</span><span class="tuareg-font-lock-operator">'</span><span class="variable-name"> </span><span class="tuareg-font-lock-operator">=</span> <span class="type">List</span>.take <span class="tuareg-font-lock-operator">((</span><span class="type">List</span>.length ks<span class="tuareg-font-lock-operator">)</span> <span class="tuareg-font-lock-operator">-</span> 1<span class="tuareg-font-lock-operator">)</span> ks <span class="tuareg-font-lock-governing">in</span>
  <span class="type">List</span>.split <span class="tuareg-font-lock-operator">(</span><span class="type">List</span>.map <span class="tuareg-font-lock-operator">(</span><span class="keyword">fun</span> <span class="variable-name">t </span><span class="tuareg-font-lock-operator">-&gt;</span>
    <span class="tuareg-font-lock-governing">let</span> <span class="variable-name">p </span><span class="tuareg-font-lock-operator">=</span> abs<span class="tuareg-font-lock-operator">((</span><span class="type">List</span>.hd t<span class="tuareg-font-lock-operator">)</span> <span class="tuareg-font-lock-operator">+</span> <span class="type">List</span>.fold_left2 <span class="tuareg-font-lock-operator">(</span><span class="keyword">fun</span> <span class="variable-name">p k big_k </span><span class="tuareg-font-lock-operator">-&gt;</span>
      p <span class="tuareg-font-lock-operator">*</span> k <span class="tuareg-font-lock-operator">*</span> <span class="tuareg-font-lock-operator">(</span>2<span class="tuareg-font-lock-operator">*</span>big_k <span class="tuareg-font-lock-operator">+</span> 1<span class="tuareg-font-lock-operator">))</span> 1 <span class="tuareg-font-lock-operator">(</span><span class="type">List</span>.tl t<span class="tuareg-font-lock-operator">)</span> ks<span class="tuareg-font-lock-operator">')</span> <span class="tuareg-font-lock-governing">in</span>
    <span class="tuareg-font-lock-operator">(</span>p<span class="tuareg-font-lock-operator">,</span> <span class="tuareg-font-lock-operator">(</span>t<span class="tuareg-font-lock-operator">,</span> <span class="tuareg-font-lock-operator">(</span>freq_of_indices fs t<span class="tuareg-font-lock-operator">))),</span> <span class="tuareg-font-lock-operator">((</span>freq_of_indices fs t<span class="tuareg-font-lock-operator">),</span> p<span class="tuareg-font-lock-operator">)</span>
  <span class="tuareg-font-lock-operator">)</span> trunc<span class="tuareg-font-lock-operator">)</span></pre>

